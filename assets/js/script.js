const datos = [
    {
        "nombre": "Prendas de Verano",
        "enlace": "prendas-de-verano",
        "productos": [
            {
                "nombre": "Vestido Floral",
                "precio": 120.00,
                "imagen": "assets/img/prendas de verano/img1.jpeg"
            },
            {
                "nombre": "Blusa Casual",
                "precio": 60.00,
                "imagen": "assets/img/prendas de verano/img2.jpeg"
            },
            {
                "nombre": "Enterizo Clásico",
                "precio": 120.00,
                "imagen": "assets/img/prendas de verano/img3.jpeg"
            }
        ]
    },
    {
        "nombre": "Prendas de Invierno",
        "enlace": "prendas-de-invierno",
        "productos": [
            {
                "nombre": "Chaqueta",
                "precio": 140.00,
                "imagen": "assets/img/prendas de invierno/img1.jpeg"
            },
            {
                "nombre": "Chalecos",
                "precio": 60.00,
                "imagen": "assets/img/prendas de invierno/img2.jpeg"
            },
            {
                "nombre": "Suéter",
                "precio": 120.00,
                "imagen": "assets/img/prendas de invierno/img3.jpeg"
            }
        ]
    },
    {
        "nombre": "Estilos Elegantes",
        "enlace": "estilos-elegantes",
        "productos": [
            {
                "nombre": "Pantalón de vestir",
                "precio": 90.00,
                "imagen": "assets/img/estilos elegantes/img1.jpeg"
            },
            {
                "nombre": "Abrigo trench",
                "precio": 150.00,
                "imagen": "assets/img/estilos elegantes/img2.jpeg"
            },
            {
                "nombre": "Blazer ajustado",
                "precio": 90.00,
                "imagen": "assets/img/estilos elegantes/img3.jpeg"
            }
        ]
    },
    {
        "nombre": "Estilos Modernos",
        "enlace": "estilos-modernos",
        "productos": [
            {
                "nombre": "Jean slouchy",
                "precio": 100.00,
                "imagen": "assets/img/estilos modernos/img1.jpeg"
            },
            {
                "nombre": "Crop Tops",
                "precio": 50.00,
                "imagen": "assets/img/estilos modernos/img2.jpeg"
            },
            {
                "nombre": "Vestido midi con abertura",
                "precio": 170.00,
                "imagen": "assets/img/estilos modernos/img3.jpeg"
            }
        ]
    },
    {
        "nombre": "Estilos Clásicos",
        "enlace": "estilos-clasicos",
        "productos": [
            {
                "nombre": "Vestido Elegante",
                "precio": 140.00,
                "imagen": "assets/img/estilos clásicos/img1.jpeg"
            },
            {
                "nombre": "Blusa Casual",
                "precio": 80.00,
                "imagen": "assets/img/estilos clásicos/img2.jpeg"
            },
            {
                "nombre": "Pantalón Clásico",
                "precio": 90.00,
                "imagen": "assets/img/estilos clásicos/img3.jpeg"
            }
        ]
    },
    {
        "nombre": "Gorros y Chalinas",
        "enlace": "gorros-y-chalinas",
        "productos": [
            {
                "nombre": "Gorro y Chalina",
                "precio": 90.00,
                "imagen": "assets/img/gorros y chalinas/img1.jpeg"
            },
            {
                "nombre": "Gorro, Chalina y Guantes",
                "precio": 150.00,
                "imagen": "assets/img/gorros y chalinas/img2.jpeg"
            },
            {
                "nombre": "Gorro y Chalina",
                "precio": 90.00,
                "imagen": "assets/img/gorros y chalinas/img3.jpeg"
            }
        ]
    },
    {
        "nombre": "Pantalones",
        "enlace": "pantalones",
        "productos": [
            {
                "nombre": "Pantalón Palazzo",
                "precio": 180.00,
                "imagen": "assets/img/pantalones/img1.jpeg"
            },
            {
                "nombre": "Pantalón Campana",
                "precio": 140.00,
                "imagen": "assets/img/pantalones/img2.jpeg"
            },
            {
                "nombre": "Pantalón Wide Leg",
                "precio": 110.00,
                "imagen": "assets/img/pantalones/img3.jpeg"
            }
        ]
    },
    {
        "nombre": "Tops",
        "enlace": "tops",
        "productos": [
            {
                "nombre": "Top color gris",
                "precio": 50.00,
                "imagen": "assets/img/tops/img1.jpeg"
            },
            {
                "nombre": "Top de manga larga",
                "precio": 70.00,
                "imagen": "assets/img/tops/img2.jpeg"
            },
            {
                "nombre": "Top de manga corta",
                "precio": 80.00,
                "imagen": "assets/img/tops/img3.jpeg"
            }
        ]
    },
    {
        "nombre": "Vestidos",
        "enlace": "vestidos",
        "productos": [
            {
                "nombre": "Vestido Wrap",
                "precio": 140.00,
                "imagen": "assets/img/vestidos/img1.jpeg"
            },
            {
                "nombre": "Vestido Empire",
                "precio": 180.00,
                "imagen": "assets/img/vestidos/img2.jpeg"
            },
            {
                "nombre": "Vestido Mermaid",
                "precio": 240.00,
                "imagen": "assets/img/vestidos/img3.jpeg"
            }
        ]
    },
    {
        "nombre": "Chaquetas",
        "enlace": "chaquetas",
        "productos": [
            {
                "nombre": "Polera blanca",
                "precio": 80.00,
                "imagen": "assets/img/chaquetas/img1.jpeg"
            },
            {
                "nombre": "Chaqueta",
                "precio": 120.00,
                "imagen": "assets/img/chaquetas/img2.jpeg"
            },
            {
                "nombre": "Casaca",
                "precio": 90.00,
                "imagen": "assets/img/chaquetas/img3.jpeg"
            }
        ]
    },
    {
        "nombre": "Ropa Formal",
        "enlace": "ropa-formal",
        "productos": [
            {
                "nombre": "Ropa formal completa",
                "precio": 170.00,
                "imagen": "assets/img/ropas formales/img1.jpeg"
            },
            {
                "nombre": "Chaqueta formal",
                "precio": 80.00,
                "imagen": "assets/img/ropas formales/img2.jpeg"
            },
            {
                "nombre": "Ropa formal completa",
                "precio": 170.00,
                "imagen": "assets/img/ropas formales/img3.jpeg"
            }
        ]
    },
    {
        "nombre": "Vestidos de Matrimonio",
        "enlace": "vestidos-de-matrimonio",
        "productos": [
            {
                "nombre": "Vestido completo",
                "precio": 270.00,
                "imagen": "assets/img/vestido de matrimonio/img1.jpeg"
            },
            {
                "nombre": "Vestido completo",
                "precio": 270.00,
                "imagen": "assets/img/vestido de matrimonio/img2.jpeg"
            },
            {
                "nombre": "Vestido completo",
                "precio": 290.00,
                "imagen": "assets/img/vestido de matrimonio/img3.jpeg"
            }
        ]
    }
    // {
    //     "nombre": "sombreros para verano",
    //     "enlace": "sombreros-para-verano",
    //     "productos":[
    //         {
    //             "nombre": "Sombrero Negro",
    //             "precio": 80.00,
    //         }
    //     ]
    // }
]


// Clase del carrito de compras
class ShoppingCart {
    constructor() {
        this.items = [];
        this.total = 0;
        this.loadCart();
        this.setupEventListeners()
        
    }

    // Agregar item al carrito
    addItem(name, price, image) {
        const existingItem = this.items.find(item => item.name === name);
        if (existingItem) {
            existingItem.quantity++;
        } else {
            this.items.push({ name, price, quantity: 1, image });
        }
        this.updateCart();
    }

    // Eliminar item del carrito
    removeItem(name) {
        const index = this.items.findIndex(item => item.name === name);
        if (index !== -1) {
            if (this.items[index].quantity > 1) {
                this.items[index].quantity--;
            } else {
                this.items.splice(index, 1);
            }
        }
        this.updateCart();
    }

    // Calcular total
    calculateTotal() {
        return this.items.reduce((sum, item) => sum + (item.price * item.quantity), 0);
    }

    // Guardar carrito en localStorage
    saveCart() {
        localStorage.setItem('shoppingCart', JSON.stringify(this.items));
    }

    // Cargar carrito desde localStorage
    loadCart() {
        const savedCart = localStorage.getItem('shoppingCart');
        if (savedCart) {
            this.items = JSON.parse(savedCart);
            this.updateCart();
        }
    }

    // Actualizar carrito y su visualización
    updateCart() {
        this.total = this.calculateTotal();
        this.saveCart();
        this.Table();
        this.updateCartDisplay()
    }

    // Mostrar items en el carrito
    Table() {
        const cartTableBody = $('#cart-table-body').empty();
        $('#cart-total-table').text(`Total: S/ ${this.total.toFixed(2)}`);
    
        $('#cart-count-table').text(`${this.items.reduce((sum, item) => sum + item.quantity, 0)} Productos`);

        this.items.forEach(item => {
            const row = $(`
                <tr>
                    <td>${item.name}</td>
                    <td>
                        <input type="number" class="form-control quantity-input" value="${item.quantity}" min="1" data-name="${item.name}">
                    </td>
                    <td>S/ ${item.price.toFixed(2)}</td>
                    <td>S/ ${(item.price * item.quantity).toFixed(2)}</td>
                    <td>
                        <button class="btn btn-danger btn-sm eliminar-item" data-name="${item.name}">Eliminar</button>
                    </td>
                </tr>
            `);
            cartTableBody.append(row);
        });
    }

    // Limpiar carrito
    clearCart() {
        this.items = [];
        this.total = 0;
        localStorage.removeItem('shoppingCart');
        this.Table();
        this.updateCartDisplay()
    }

      // Eliminar item del carrito
      removeItem(name) {
        const index = this.items.findIndex(item => item.name === name);
        if (index !== -1) {
            if (this.items[index].quantity > 1) {
                this.items[index].quantity--;
            } else {
                this.items.splice(index, 1);
            }
        }
        this.updateCart();
    }

    updateItemQuantity(name, quantity) {
        const item = this.items.find(item => item.name === name);
        if (item) {
            item.quantity = quantity;
            if (item.quantity < 1) {
                this.removeItem(name);
            } else {
                this.updateCart();
            }
        }
    }

    updateCartDisplay() {
        const cartItemsContainer = $('#cart-items').empty();
        $('#cart-total').text(`Total: S/ ${this.total.toFixed(2)}`);
        $('#cart-count').text(this.items.reduce((sum, item) => sum + item.quantity, 0));

        this.items.forEach(item => {
            const itemElement = $(
                `<div class="cart-item">
                    <img src="${item.image}" width="50" height="50" style="object-fit: cover;">
                    <div>
                        <span>${item.name}</span>
                        <span>S/ ${item.price.toFixed(2)}</span>
                    </div>
                    <div class="d-flex gap-2">
                        <button class="btn btn-sm btn-secondary remove-item" data-name="${item.name}">-</button>
                        <span>${item.quantity}</span>
                        <button class="btn btn-sm btn-primary add-item" data-name="${item.name}">+</button>
                    </div>
                </div>`
            );
            cartItemsContainer.append(itemElement);
        });
    }

    // Configurar event listeners para la tabla del carrito
    setupEventListeners() {
        // Usamos delegación de eventos para elementos dinámicos
        $('#cart-table-body').on('click', '.eliminar-item', (e) => {
            const name = $(e.currentTarget).data('name');
            this.removeItem(name);
        });

        $('#cart-table-body').on('change', '.quantity-input', (e) => {
            console.log("input-quantity")
            const name = $(e.currentTarget).data('name');
            const quantity = parseInt($(e.currentTarget).val());
            if (isNaN(quantity) || quantity < 1) {
                // Restaurar a 1 si la cantidad es inválida
                $(e.currentTarget).val(1);
                this.updateItemQuantity(name, 1);
            } else {
                this.updateItemQuantity(name, quantity);
            }
        });
    }
}

$(document).ready(function () {

    // $('button').on('click', function (event) {
    //     event.preventDefault(); // Evita la recarga de la página
    //     alert('¡Un botón fue clickeado, pero la página no se recargó!');
    // });

    window.cart = new ShoppingCart();

    // Manejador de botón "Agregar al carrito"
    $(document).on('click', '.btn-primary[data-product]', function () {
        // console.log('Se hizo click en el botón de agregar al carrito');
        const name = $(this).data('name');
        const price = parseFloat($(this).data('price'));
        const image = $(this).closest('.card').find('.card-img-top').attr('src');
        console.log(name, price, image)
        window.cart.addItem(name, price, image);
        window.cart.Table(); 
        // Actualiza la lista desplegable de productos
    });

    // Agregar item en el modal del carrito
    $(document).on('click', '.add-item', function () {
        const name = $(this).data('name');
        const item = window.cart.items.find(i => i.name === name);
        if (item) {
            window.cart.addItem(name, item.price, item.image);
        }
    });

    // Eliminar item en el modal del carrito
    $(document).on('click', '.remove-item', function () {
        const name = $(this).data('name');
        window.cart.removeItem(name);
    });

    // Botón para limpiar el carrito
    $('#clear-cart').on('click', function () {
        window.cart.clearCart();
    });

    // Efecto hover en las tarjetas
    $(".card").hover(
        function () {
            $(this).addClass("shadow-lg");
        },
        function () {
            $(this).removeClass("shadow-lg");
        }
    );

    // Cerrar menú al hacer clic fuera
    document.addEventListener("click", function (event) {
        const menu = document.querySelector(".menu");
        const menuContent = document.querySelector(".menu-content");
        if (!menu.contains(event.target)) {
            menuContent.style.display = "none";
        }
    });
    
    function generarCategorias(categorias) {
        console.log(categorias)
    const contenedor = $('#contenedor-categorias');

    categorias.forEach(categoria => {
      const seccion = $(`
        <section class="container py-5" id="${categoria.enlace}">
          <h2 class="text-center mb-4">${categoria.nombre}</h2>
          <div class="row g-4"></div>
        </section>
      `);

      categoria.productos.forEach(producto => {
        const tarjeta = $(`
          <div class="col-md-4">
            <div class="card">
              <img src="${producto.imagen}" class="card-img-top" alt="${producto.nombre}">
              <div class="card-body">
                <h5 class="card-title">${producto.nombre}</h5>
                <p class="card-text">S/ ${producto.precio.toFixed(2)}</p>
                <button href="#" class="btn btn-primary" data-product="true" data-name="${producto.nombre}" data-price="${producto.precio}">Comprar ahora</button>
              </div>
            </div>
          </div>
        `);
        seccion.find('.row').append(tarjeta);
      });

      contenedor.append(seccion);
    });
  }

  generarCategorias(datos)
 
});
